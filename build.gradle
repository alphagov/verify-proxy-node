buildscript {
    repositories {
        maven { url 'https://dl.bintray.com/alphagov/maven-test' }
        jcenter()
    }
    dependencies {
        classpath 'com.github.spullara.mustache.java:compiler:0.8.10',
                'org.yaml:snakeyaml:1.10',
                'com.google.guava:guava:14.0.1',
                'com.github.ben-manes:gradle-versions-plugin:0.17.0'
    }
}

apply plugin: 'java'
apply plugin: 'com.github.ben-manes.versions'

ext {
    opensaml_version = '3.4.0'
    dropwizard_version = '1.3.9'
    utils_version = '2.0.0-350'
    saml_libs_version = "${opensaml_version}-180"
    build_version = "$opensaml_version-${System.env.BUILD_NUMBER ?: 'SNAPSHOT'}"
}

subprojects {

    apply plugin: 'java'

    group = "uk.gov.ida"
    version = "0.1.$version"

    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11

    tasks.withType(JavaCompile) {
        options.encoding = 'UTF-8'
    }

    repositories {
        maven { url 'https://dl.bintray.com/alphagov/maven-test' }
        maven { url 'https://dl.bintray.com/alphagov/maven' }
        maven { url 'https://build.shibboleth.net/nexus/content/repositories/releases' }
        jcenter()
    }

    sourceSets {
        test {
            resources.srcDirs += ["src/dist"]
        }
    }

    configurations {
        common
        dropwizard
        opensaml
        eidas_saml
        ida_utils
        verify_saml
        verify_saml_test
        proxy_node_test
        soft_hsm
    }

    dependencies {
        common(
                "javax.xml.bind:jaxb-api:2.3.0",
                "javax.activation:activation:1.1.1",
                "io.lettuce:lettuce-core:5.1.4.RELEASE",
        )

        dropwizard(
                "io.dropwizard:dropwizard-core:${dropwizard_version}",
                "io.dropwizard:dropwizard-client:${dropwizard_version}",
                "io.dropwizard:dropwizard-views-mustache:${dropwizard_version}",
                "io.dropwizard:dropwizard-views-mustache:${dropwizard_version}",
                "uk.gov.ida:dropwizard-logstash:1.3.5-68",
                "com.smoketurner.dropwizard:zipkin-core:${dropwizard_version}-1"
        )

        opensaml(
                "org.opensaml:opensaml-core:${opensaml_version}",
                "org.opensaml:opensaml-saml-impl:${opensaml_version}",
                "org.opensaml:opensaml-storage-impl:${opensaml_version}",
        )

        eidas_saml(
                "se.litsec.eidas:eidas-opensaml3:1.3.1",
                "se.litsec.opensaml:opensaml3-ext:1.2.2",
        )

        ida_utils(
                "uk.gov.ida:rest-utils:${utils_version}"
        )

        verify_saml(
                "uk.gov.ida:saml-extensions:${saml_libs_version}",
                "uk.gov.ida:saml-metadata-bindings:${saml_libs_version}",
                "uk.gov.ida:saml-security:${saml_libs_version}",
                "uk.gov.ida:saml-utils:${saml_libs_version}",
                "uk.gov.ida:security-utils:${utils_version}",
        )

        verify_saml_test(
                "uk.gov.ida:common-test-utils:${utils_version}",
                "uk.gov.ida:saml-metadata-bindings-test:${saml_libs_version}",
        )
        
        proxy_node_test(
                "net.sourceforge.htmlcleaner:htmlcleaner:2.22",
                "net.sourceforge.htmlunit:htmlunit:2.28",
        )

        testCompile(
                "org.junit.jupiter:junit-jupiter-api:5.4.0",
                'org.junit.jupiter:junit-jupiter-params:5.4.0',
                "org.assertj:assertj-core:3.11.1",
                "org.mockito:mockito-core:2.25.0",
                "org.mockito:mockito-junit-jupiter:2.17.0",
                "io.dropwizard:dropwizard-testing:${dropwizard_version}",
                "net.sourceforge.htmlunit:htmlunit:2.28",
                "com.github.stefanbirkner:system-rules:1.19.0",
                "com.github.fppt:jedis-mock:0.1.9",
                project(':proxy-node-test'),
        )

        testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.3.1'
    }
}

defaultTasks 'clean', 'test'
